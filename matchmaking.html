<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Odd Heroes - Matchmaking</title>
<style>
  body { background: #000; color: #0f0; font-family: monospace; text-align: center; padding: 2rem; }
  #status { font-size: 1.5rem; margin-top: 1rem; }
</style>
</head>
<body>
<h1>Odd Heroes - Matchmaking</h1>
<div id="status">Searching for opponent...</div>

<script>
const params = new URLSearchParams(window.location.search);
const hero = params.get('hero') || 'Unknown Hero';
const statusDiv = document.getElementById('status');

// Generate a unique player id
const playerId = crypto.randomUUID();

async function joinQueue() {
  try {
    const res = await fetch("https://matchmaking.oddheroesonline.workers.dev/find-match", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ hero, id: playerId })
    });

    const data = await res.json();
    console.log("Queue response:", data);

    if (data.status === "matched") {
      // Redirect to game.html only when real opponent found
      window.location.href = data.url;
    } else {
      // Still waiting
      statusDiv.textContent = "Searching for opponent...";
      setTimeout(joinQueue, 2000);
    }
  } catch (err) {
    console.error("Matchmaking error:", err);
    statusDiv.textContent = "Error connecting to server. Retrying...";
    setTimeout(joinQueue, 3000);
  }
}

joinQueue();
</script>
</body>
</html>
