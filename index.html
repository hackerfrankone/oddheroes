<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Odd Heroes</title>
  <link rel="icon" type="image/png" href="oddheroes/images/OHO.png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share_Tech_Mono&display=swap');
    html, body {
      margin: 0;
      padding: 0;
      overflow: auto;
      background-color: #000;
      font-family: 'Share Tech Mono', monospace;
      color: #00b300;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      user-select: none;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      text-shadow: 0 0 8px #00b300;
      text-align: center;
    }
    .category-container {
      width: 90%;
      max-width: 600px;
      margin-bottom: 1rem;
    }
    .category-title {
      font-size: 1.8rem;
      margin: 0.5rem 0;
      text-shadow: 0 0 8px #00b300, 0 0 15px #00b300;
      text-align: left;
      cursor: pointer;
      padding: 0.7rem 1rem;
      background: linear-gradient(to bottom, #003300, #001100);
      border: 2px solid #00b300;
      border-radius: 10px;
      box-shadow: 0 0 10px #00b300;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: box-shadow 0.3s ease, background 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .category-title:hover {
      box-shadow: 0 0 15px #00b300, 0 0 20px #00b300;
      background: linear-gradient(to bottom, #005500, #003300);
    }
    .category-title::after {
      content: '▶';
      font-size: 1.5rem;
      text-shadow: 0 0 4px #00b300;
      transition: transform 0.3s ease;
    }
    .category-title.expanded::after {
      content: '▼';
    }
    .selected-hero {
      font-size: 1.2rem;
      margin-right: 1rem;
      text-shadow: 0 0 4px #00b300;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      padding: 10px;
      background-color: #001100;
      border-radius: 8px;
      border: 1px solid #00b300;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.3s ease, opacity 0.3s ease;
      visibility: hidden;
      max-width: 600px;
      width: 100%;
      box-sizing: border-box;
    }
    .grid-container.expanded {
      max-height: 500px;
      opacity: 1;
      visibility: visible;
    }
    .hero-tile {
      background-color: #003300;
      border: 2px solid #00b300;
      border-radius: 8px;
      text-align: center;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 0.5rem;
      min-height: 80px;
      position: relative;
    }
    .hero-tile:hover {
      background-color: #005500;
      box-shadow: 0 0 10px #00b300, 0 0 20px #00b300;
    }
    .hero-tile.selected {
      background-color: #00b300;
      color: #000;
      box-shadow: 0 0 15px #00b300, 0 0 25px #00b300;
      font-weight: bold;
    }
    .hero-icon {
      font-size: 1.8rem;
      margin-bottom: 0.3rem;
      position: relative;
    }
    #selected-heroes {
      margin-top: 0.5rem;
      font-size: 1.3rem;
      text-shadow: 0 0 8px #00b300;
      min-height: 2rem;
      text-align: center;
    }
    #start-button {
      margin: 1.5rem 0;
      padding: 0.8rem 2rem;
      font-size: 1.3rem;
      background-color: #00b300;
      border: none;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 8px #00b300;
      display: none;
      transition: background-color 0.3s ease;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: #001100;
      border: 2px solid #00b300;
      border-radius: 10px;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 0 15px #00b300;
      max-width: 400px;
      width: 90%;
    }
    .passive-display {
      margin-bottom: 1rem;
      padding: 0.8rem;
      background-color: #002200;
      border: 1px solid #00b300;
      border-radius: 8px;
      text-align: left;
      font-size: 1rem;
      text-shadow: 0 0 4px #00b300;
    }
    .passive-display .label {
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .passive-display .description {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    .instruction {
      font-size: 1rem;
      font-weight: bold;
      text-align: center;
      text-shadow: 0 0 4px #00b300;
    }
    .options {
      display: flex;
      justify-content: space-around;
      margin-top: 0.5rem;
      flex-wrap: wrap;
      gap: 10px;
    }
    .option {
      background-color: #003300;
      border: 2px solid #00b300;
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      width: 45%;
      transition: background-color 0.3s ease;
      box-sizing: border-box;
    }
    .option:hover {
      background-color: #005500;
    }
    .option .icon {
      font-size: 2rem;
      display: block;
      margin-bottom: 0.5rem;
    }
    .single-option {
      width: 60%;
      margin: 0 auto;
    }
    @media (max-width: 400px) {
      h1 { font-size: 2rem; }
      .category-title { font-size: 1.5rem; padding: 0.5rem 0.8rem; }
      .category-title::after { font-size: 1.2rem; }
      .selected-hero { font-size: 1rem; }
      .hero-tile { font-size: 0.9rem; min-height: 70px; }
      .hero-icon { font-size: 1.5rem; }
      .grid-container { grid-template-columns: repeat(3, 1fr); max-width: 100%; }
      #selected-heroes { font-size: 1.1rem; }
      #start-button { font-size: 1.1rem; padding: 0.6rem 1.5rem; }
      .option { width: 80%; }
      .single-option { width: 90%; }
      .option .icon { font-size: 1.5rem; }
      .passive-display { font-size: 0.9rem; }
      .passive-display .description { font-size: 0.8rem; }
      .instruction { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <h1>Pick Your Odd Hero Team</h1>
  <div id="categories"></div>
  <div id="selected-heroes"></div>
  <button id="start-button">Start Game</button>
  <div id="modals"></div>
  <!-- Load all hero GUI files -->
  <script src="heroes/legends/fairy/GUI.js"></script>
  <script src="heroes/legends/medusa/GUI.js"></script>
  <script src="heroes/legends/phoenix/GUI.js"></script>
  <script src="heroes/legends/big-foot/GUI.js"></script>
  <script src="heroes/legends/dinosaur/GUI.js"></script>
  <script src="heroes/legends/dragon/GUI.js"></script>
  <script src="heroes/legends/ghost/GUI.js"></script>
  <script src="heroes/legends/centaur/GUI.js"></script>
  <script src="heroes/legends/merfolk/GUI.js"></script>
  <script src="heroes/humans/miner/GUI.js"></script>
  <script src="heroes/humans/alchemist/GUI.js"></script>
  <script src="heroes/humans/wizard/GUI.js"></script>
  <script src="heroes/humans/hunter/GUI.js"></script>
  <script src="heroes/humans/vampire/GUI.js"></script>
  <script src="heroes/humans/werewolf/GUI.js"></script>
  <script src="heroes/humans/fisherman/GUI.js"></script>
  <script src="heroes/humans/ninja/GUI.js"></script>
  <script src="heroes/humans/samurai/GUI.js"></script>
  <script src="heroes/humans/spartan/GUI.js"></script>
  <script src="heroes/creatures/chicken/GUI.js"></script>
  <script src="heroes/creatures/shark/GUI.js"></script>
  <script src="heroes/creatures/dog/GUI.js"></script>
  <script src="heroes/creatures/falcon/GUI.js"></script>
  <script src="heroes/creatures/frog/GUI.js"></script>
  <script src="heroes/creatures/turtle/GUI.js"></script>
  <script src="heroes/creatures/lobster/GUI.js"></script>
  <script src="heroes/creatures/bear/GUI.js"></script>
  <script src="heroes/creatures/tiger/GUI.js"></script>
  <script src="heroes/creatures/raccoon/GUI.js"></script>
  <script src="heroes/creatures/boar/GUI.js"></script>
  <script src="heroes/creatures/lizard/GUI.js"></script>
  <script src="heroes/creatures/mole/GUI.js"></script>
  <script src="heroes/creatures/duck/GUI.js"></script>
  <script src="heroes/creatures/rat/GUI.js"></script>
  <script src="heroes/creatures/honey-badger/GUI.js"></script>
  <script src="heroes/uniques/worm/GUI.js"></script>
  <script src="heroes/uniques/mosquito/GUI.js"></script>
  <script src="heroes/uniques/tick/GUI.js"></script>
  <script src="heroes/uniques/leech/GUI.js"></script>
  <script src="heroes/uniques/pilot/GUI.js"></script>
  <script src="heroes/uniques/germ/GUI.js"></script>
  <script src="heroes/uniques/livingtree/GUI.js"></script>
  <script src="heroes/uniques/ai/GUI.js"></script>
  <script>
    // Hero-list
    const heroNames = [
      'AI', 'BigFoot', 'Centaur', 'Dinosaur', 'Dragon', 'Fairy', 'Ghost', 'Medusa', 'Merfolk', 'Phoenix',
      'Alchemist', 'Fisherman', 'Hunter', 'Miner', 'Ninja', 'Samurai', 'Spartan', 'Vampire', 'Warrior', 'Wizard',
      'Bear', 'Boar', 'Chicken', 'Dog', 'Duck', 'Falcon', 'Frog', 'HoneyBadger', 'Lizard', 'Mole', 'Raccoon', 'Rat', 'Shark', 'Tiger', 'Turtle',
      'Germ', 'Leech', 'LivingTree', 'Mosquito Swarm', 'Tick', 'Worm', 'Pilot'
    ];
    // pull from directory hero GUIs
    const heroData = [];
    const categoriesMap = {};
    heroNames.forEach(heroName => {
      const hero = window[`${heroName.replace(/\s+/g, '')}Data`];
      if (!hero) {
        console.error(`Error: Data for ${heroName} not found. Check if heroes/${hero?.category?.toLowerCase() || 'unknown'}/${heroName.toLowerCase().replace(/\s+/g, '-')}/GUI.js is loaded.`);
        return;
      }
      const catId = hero.id;
      if (!categoriesMap[catId]) {
        categoriesMap[catId] = {
          category: hero.category,
          id: catId,
          heroes: []
        };
        heroData.push(categoriesMap[catId]);
      }
      categoriesMap[catId].heroes.push({
        name: hero.name,
        icon: hero.icon,
        abilities: hero.abilities,
        passive: hero.passive
      });
    });
    // Log loaded heroes for debugging
    console.log('Loaded heroes:', heroData.map(cat => ({
      category: cat.category,
      heroes: cat.heroes.map(h => h.name)
    })));
    // Sort in order
    heroData.forEach(category => {
      category.heroes.sort((a, b) => a.name.localeCompare(b.name));
    });
    // Define custom category order
    const categoryOrder = ['Legends', 'Creatures', 'Humans', 'Uniques'];
    // Sort heroData to enforce custom category order
    heroData.sort((a, b) => categoryOrder.indexOf(a.category) - categoryOrder.indexOf(b.category));
    // Error handling if no heroes are loaded
    if (heroData.length === 0) {
      console.error('Error: No hero data loaded. Ensure hero GUI files are included.');
      const errorMessage = document.createElement('div');
      errorMessage.style.color = '#f00';
      errorMessage.textContent = 'Error loading hero data. Please check if hero GUI files are correctly included.';
      document.body.appendChild(errorMessage);
    } else {
      // Dynamically generate categories and hero tiles
      const categoriesContainer = document.getElementById('categories');
      const modalsContainer = document.getElementById('modals');
      const selectedHeroesDiv = document.getElementById('selected-heroes');
      const startButton = document.getElementById('start-button');
      let selectedHeroes = [];
      const sessionId = crypto.randomUUID();
      const categories = heroData.map(cat => ({
        title: null,
        list: null,
        selected: null,
        display: null,
        id: cat.id
      }));
      // Disable start button by default
      startButton.disabled = true;
      heroData.forEach((cat, index) => {
        // Create category container
        const categoryContainer = document.createElement('div');
        categoryContainer.className = 'category-container';
        // Create category title
        const categoryTitle = document.createElement('div');
        categoryTitle.className = 'category-title';
        categoryTitle.id = `${cat.id}-title`;
        categoryTitle.innerHTML = `<span class="selected-hero"></span>${cat.category}`;
        // Create grid container
        const gridContainer = document.createElement('div');
        gridContainer.className = 'grid-container';
        gridContainer.id = `${cat.id}-list`;
        // Populate hero tiles
        cat.heroes.forEach(hero => {
          const heroTile = document.createElement('div');
          heroTile.className = 'hero-tile';
          heroTile.innerHTML = `<div class="hero-icon">${hero.icon}</div>${hero.name}`;
          gridContainer.appendChild(heroTile);
        });
        categoryContainer.appendChild(categoryTitle);
        categoryContainer.appendChild(gridContainer);
        categoriesContainer.appendChild(categoryContainer);
        // Update categories array
        categories[index].title = categoryTitle;
        categories[index].list = gridContainer;
        categories[index].display = categoryTitle.querySelector('.selected-hero');
        // Create modal for each hero
        cat.heroes.forEach(hero => {
          const modal = document.createElement('div');
          modal.id = `${hero.name.toLowerCase().replace(/\s+/g, '-')}-modal`;
          modal.className = 'modal';
          const modalContent = document.createElement('div');
          modalContent.className = 'modal-content';
          modalContent.innerHTML = `
            <div class="passive-display">
              <div class="label">Passive: ${hero.passive?.label || 'No Passive'}</div>
              ${hero.passive?.description ? `<div class="description">${hero.passive.description}</div>` : ''}
              <div class="instruction">Pick a CD ability</div>
            </div>
            <div class="options"></div>
          `;
          const optionsContainer = modalContent.querySelector('.options');
          hero.abilities.forEach(ability => {
            const option = document.createElement('div');
            option.className = `option ${hero.abilities.length === 1 ? 'single-option' : ''}`;
            option.setAttribute('data-choice', ability.choice);
            option.innerHTML = `<span class="icon">${hero.icon}</span>${ability.label}${ability.description ? '<br>' + ability.description : ''}`;
            optionsContainer.appendChild(option);
          });
          modal.appendChild(modalContent);
          modalsContainer.appendChild(modal);
        });
      });
      // Toggle categories
      categories.forEach(cat => {
        cat.title.addEventListener('click', () => {
          const expanded = cat.list.classList.contains('expanded');
          categories.forEach(c => {
            c.list.classList.remove('expanded');
            c.title.classList.remove('expanded');
          });
          if (!expanded) {
            cat.list.classList.add('expanded');
            cat.title.classList.add('expanded');
          }
        });
      });
      // Hero selection
      categories.forEach(cat => {
        cat.list.addEventListener('click', e => {
          const tile = e.target.closest('.hero-tile');
          if (!tile) return;
          const heroName = tile.querySelector('.hero-icon').nextSibling.textContent.trim();
          const heroIcon = tile.querySelector('.hero-icon').textContent;
          // If a hero is already selected in this category, deselect it
          if (cat.selected) {
            const selectedTile = cat.list.querySelector('.selected');
            if (selectedTile) selectedTile.classList.remove('selected');
            // Hide previous modal
            const prevHeroName = cat.selected.name;
            const prevModal = document.getElementById(`${prevHeroName.toLowerCase().replace(/\s+/g, '-')}-modal`);
            prevModal.style.display = 'none';
          }
          // Select new hero
          tile.classList.add('selected');
          cat.selected = { name: heroName, icon: heroIcon, ability: null };
          cat.display.textContent = `${heroName}`; // Show only hero name initially
          selectedHeroes = categories.map(c => c.selected).filter(h => h);
          // Find hero data
          const heroCat = heroData.find(c => c.id === cat.id);
          const hero = heroCat.heroes.find(h => h.name === heroName);
          // Show modal
          const modal = document.getElementById(`${heroName.toLowerCase().replace(/\s+/g, '-')}-modal`);
          modal.style.display = 'flex';
          const options = modal.querySelectorAll('.option');
          options.forEach(opt => {
            opt.addEventListener('click', function handleChoice() {
              const choice = this.getAttribute('data-choice');
              cat.selected.ability = choice;
              const ability = hero.abilities.find(a => a.choice === choice);
              cat.display.textContent = `${heroName}: ${ability.label}`; // Updated format
              modal.style.display = 'none';
              cat.list.classList.remove('expanded');
              cat.title.classList.remove('expanded');
              options.forEach(o => o.removeEventListener('click', handleChoice));
              // Update selected heroes display with <br> tags
              selectedHeroes = categories.map(c => c.selected).filter(h => h);
              selectedHeroesDiv.innerHTML = selectedHeroes.length
                ? `Selected:<br>${selectedHeroes.map(h => `${h.name}${h.ability ? ': ' + h.ability : ''}`).join('<br>')}`
                : '';
              // Enable start button if one hero is selected from each category with an ability
              startButton.style.display = selectedHeroes.length && !selectedHeroes.some(h => !h.ability) ? 'inline-block' : 'none';
              startButton.disabled = selectedHeroes.length !== categories.length || selectedHeroes.some(h => !h.ability);
            }, { once: true });
          });
          // Update selected heroes display with <br> tags
          selectedHeroesDiv.innerHTML = selectedHeroes.length
            ? `Selected:<br>${selectedHeroes.map(h => `${h.name}${h.ability ? ': ' + h.ability : ''}`).join('<br>')}`
            : '';
          // Enable start button if one hero is selected from each category with an ability
          startButton.style.display = selectedHeroes.length && !selectedHeroes.some(h => !h.ability) ? 'inline-block' : 'none';
          startButton.disabled = selectedHeroes.length !== categories.length || selectedHeroes.some(h => !h.ability);
        });
      });
      // Start button - redirect with selected heroes and sessionId
      startButton.addEventListener('click', () => {
        if (selectedHeroes.length !== categories.length || selectedHeroes.some(h => !h.ability)) return;
        const heroesQuery = encodeURIComponent(JSON.stringify(selectedHeroes.map(h => ({ name: h.name, ability: h.ability }))));
        window.location.href = `matchmaking.html?heroes=${heroesQuery}&sessionId=${encodeURIComponent(sessionId)}`;
      });
    }
  </script>
</body>
</html>
