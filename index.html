<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Odd Heroes</title>
  <link rel="icon" type="image/png" href="/oddheroes/images/OHO.png" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: auto;
      background-color: #000;
      font-family: 'Share Tech Mono', monospace;
      color: #00b300;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      user-select: none;
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      text-align: center;
      width: 100%;
    }
    .category-container {
      width: 90%;
      max-width: 600px;
      margin-bottom: 1rem;
    }
    .category-title {
      font-size: 1.8rem;
      margin: 0.5rem 0;
      text-align: left;
      cursor: pointer;
      padding: 0.7rem 1rem;
      background: linear-gradient(to bottom, #003300, #001100);
      border: 2px solid #00b300;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      overflow: hidden;
    }
    .category-title:hover {
      background: linear-gradient(to bottom, #005500, #003300);
    }
    .category-title::after {
      content: '▶';
      font-size: 1.5rem;
    }
    .category-title.expanded::after {
      content: '▼';
    }
    .selected-hero {
      font-size: 1.2rem;
      margin-right: 1rem;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      padding: 10px;
      background-color: #001100;
      border-radius: 8px;
      border: 1px solid #00b300;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.3s ease, opacity 0.3s ease;
      visibility: hidden;
      max-width: 600px;
      width: 100%;
      box-sizing: border-box;
    }
    .grid-container.expanded {
      max-height: 500px;
      opacity: 1;
      visibility: visible;
    }
    .hero-tile {
      background-color: #003300;
      border: 2px solid #00b300;
      border-radius: 8px;
      text-align: center;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 0.5rem;
      min-height: 80px;
      position: relative;
    }
    .hero-tile:hover {
      background-color: #005500;
    }
    .hero-tile.selected {
      background-color: #00b300;
      color: #000;
      font-weight: bold;
    }
    .hero-icon {
      font-size: 1.8rem;
      margin-bottom: 0.3rem;
      position: relative;
    }
    #selected-heroes {
      margin-top: 0.5rem;
      font-size: 1.3rem;
      min-height: 2rem;
      text-align: center;
      width: 90%;
      max-width: 600px;
    }
    #start-button {
      padding: 0.8rem 2rem;
      font-size: 1.3rem;
      background-color: #00b300;
      border: none;
      border-radius: 8px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: none;
      width: 200px;
    }
    #start-button-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      max-width: 600px;
      margin-top: 0.5rem;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: #001100;
      border: 2px solid #00b300;
      border-radius: 10px;
      padding: 1.5rem;
      text-align: center;
      max-width: 600px; /* Increased for scalability */
      width: 90%;
      position: relative;
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.2rem;
      color: #00b300;
      cursor: pointer;
    }
    .modal-close:hover {
      color: #005500;
    }
    .stats-display {
      margin-bottom: 1rem;
      padding: 0.8rem;
      background-color: #002200;
      border: 1px solid #00b300;
      border-radius: 8px;
      text-align: left;
      font-size: 0.9rem;
    }
    .stats-display .label {
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .stats-display .value {
      font-size: 0.9rem;
    }
    .passive-display {
      margin-bottom: 1rem;
      padding: 0.8rem;
      background-color: #002200;
      border: 1px solid #00b300;
      border-radius: 8px;
      text-align: left;
      font-size: 0.9rem;
    }
    .passive-display .label {
      font-weight: bold;
      margin-bottom: 0.3rem;
    }
    .passive-display .description {
      font-size: 0.9rem;
    }
    .instruction {
      font-size: 1rem;
      font-weight: bold;
      text-align: center;
      margin: 0.5rem 0;
    }
    .options {
      display: flex;
      flex-direction: row;
      flex-wrap: nowrap;
      overflow-x: auto;
      margin-top: 0.5rem;
      gap: 10px;
      padding-bottom: 0.5rem; /* Space for scrollbar */
    }
    .option {
      background-color: #003300;
      border: 2px solid #00b300;
      border-radius: 8px;
      padding: 1rem;
      cursor: pointer;
      min-width: 150px; /* Fixed width for consistency */
      flex: 0 0 auto; /* Prevent stretching */
      transition: background-color 0.3s ease;
      box-sizing: border-box;
      text-align: center;
    }
    .option:hover {
      background-color: #005500;
    }
    .option .icon {
      font-size: 2rem;
      display: block;
      margin-bottom: 0.5rem;
    }
    .single-option {
      min-width: 150px; /* Match .option for consistency */
      margin: 0 auto;
    }
    .password-modal {
      display: flex;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.9);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .password-modal-content {
      background-color: #001100;
      border: 2px solid #00b300;
      border-radius: 10px;
      padding: 1.5rem;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    .password-modal-content input {
      padding: 0.5rem;
      margin: 0.5rem 0;
      border: 1px solid #00b300;
      background-color: #002200;
      color: #00b300;
      font-family: monospace;
      font-size: 1rem;
      border-radius: 5px;
      width: 80%;
    }
    .password-modal-content button {
      padding: 0.5rem 1rem;
      background-color: #00b300;
      border: none;
      border-radius: 5px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    .password-modal-content button:hover {
      background-color: #005500;
    }
    .password-modal-content .error {
      color: #f00;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }
    .hidden {
      display: none;
    }
    @media (max-width: 400px) {
      h1 { font-size: 2rem; }
      .category-title { font-size: 1.5rem; padding: 0.5rem 0.8rem; }
      .category-title::after { font-size: 1.2rem; }
      .selected-hero { font-size: 1rem; }
      .hero-tile { font-size: 0.9rem; min-height: 70px; }
      .hero-icon { font-size: 1.5rem; }
      .grid-container { grid-template-columns: repeat(3, 1fr); max-width: 100%; }
      .modal-content { max-width: 90%; } /* Adjust for smaller screens */
      #selected-heroes { font-size: 1.1rem; }
      #start-button { font-size: 1.1rem; padding: 0.6rem 1.5rem; width: 160px; }
      .option { min-width: 120px; } /* Smaller width for mobile */
      .single-option { min-width: 120px; }
      .option .icon { font-size: 1.5rem; }
      .stats-display { font-size: 0.8rem; }
      .stats-display .value { font-size: 0.8rem; }
      .passive-display { font-size: 0.8rem; }
      .passive-display .description { font-size: 0.8rem; }
      .instruction { font-size: 0.9rem; }
      .password-modal-content { padding: 1rem; }
      .password-modal-content input { font-size: 0.9rem; }
      .password-modal-content button { font-size: 0.9rem; }
      .password-modal-content .error { font-size: 0.8rem; }
      .modal-close { font-size: 1rem; }
    }
  </style>
  <script id="x7b9k2m4">
    window.oddchunk1 = '^4.';
  </script>
  <script id="q3z8n6j1">
    window.oddchunk2 = 'BF.';
  </script>
  <script id="t9m4p8v3">
    window.oddchunk3 = '*%U';
  </script>
  <script id="r2k7w5y9">
    window.oddchunk4 = '>KN';
  </script>
  <script id="h6n3j8q2">
    window.oddchunk5 = 'D,n';
  </script>
  <script id="p4v9m2k7">
    window.oddchunk6 = '32@';
  </script>
  <script id="j8q3y6n1">
    window.oddchunk7 = '#$k';
  </script>
  <script id="w5t2p9v4">
    window.oddchunk8 = 'd.#';
  </script>
  <script id="k7m8r3z6">
    window.oddchunk9 = '@!';
  </script>
</head>
<body>
  <div id="password-modal" class="password-modal">
    <div class="password-modal-content">
      <h2>Enter Access Password</h2>
      <input type="password" id="password-input" placeholder="Enter password">
      <button onclick="checkPassword()">Submit</button>
      <div id="password-error" class="error"></div>
    </div>
  </div>
  <div id="main-content" class="hidden">
    <h1>Pick Your Odd Heroes</h1>
    <div id="categories"></div>
    <div id="selected-heroes"></div>
    <div id="start-button-container">
      <button id="start-button">Start Game</button>
    </div>
    <div id="modals"></div>
  </div>
  <!-- Load all hero GUI files -->
  <script src="/heroes/legends/fairy/GUI.js"></script>
  <script src="/heroes/legends/medusa/GUI.js"></script>
  <script src="/heroes/legends/phoenix/GUI.js"></script>
  <script src="/heroes/legends/big-foot/GUI.js"></script>
  <script src="/heroes/legends/dinosaur/GUI.js"></script>
  <script src="/heroes/legends/dragon/GUI.js"></script>
  <script src="/heroes/legends/ghost/GUI.js"></script>
  <script src="/heroes/legends/centaur/GUI.js"></script>
  <script src="/heroes/legends/merfolk/GUI.js"></script>
  <script src="/heroes/humans/miner/GUI.js"></script>
  <script src="/heroes/humans/alchemist/GUI.js"></script>
  <script src="/heroes/humans/wizard/GUI.js"></script>
  <script src="/heroes/humans/hunter/GUI.js"></script>
  <script src="/heroes/humans/vampire/GUI.js"></script>
  <script src="/heroes/humans/werewolf/GUI.js"></script>
  <script src="/heroes/humans/fisherman/GUI.js"></script>
  <script src="/heroes/humans/ninja/GUI.js"></script>
  <script src="/heroes/humans/samurai/GUI.js"></script>
  <script src="/heroes/humans/spartan/GUI.js"></script>
  <script src="/heroes/creatures/chicken/GUI.js"></script>
  <script src="/heroes/creatures/shark/GUI.js"></script>
  <script src="/heroes/creatures/dog/GUI.js"></script>
  <script src="/heroes/creatures/falcon/GUI.js"></script>
  <script src="/heroes/creatures/frog/GUI.js"></script>
  <script src="/heroes/creatures/frog/abilities.js"></script>
  <script src="/heroes/creatures/turtle/GUI.js"></script>
  <script src="/heroes/creatures/lobster/GUI.js"></script>
  <script src="/heroes/creatures/bear/GUI.js"></script>
  <script src="/heroes/creatures/tiger/GUI.js"></script>
  <script src="/heroes/creatures/raccoon/GUI.js"></script>
  <script src="/heroes/creatures/boar/GUI.js"></script>
  <script src="/heroes/creatures/lizard/GUI.js"></script>
  <script src="/heroes/creatures/mole/GUI.js"></script>
  <script src="/heroes/creatures/duck/GUI.js"></script>
  <script src="/heroes/creatures/rat/GUI.js"></script>
  <script src="/heroes/creatures/honey-badger/GUI.js"></script>
  <script src="/heroes/uniques/worm/GUI.js"></script>
  <script src="/heroes/uniques/mosquito/GUI.js"></script>
  <script src="/heroes/uniques/tick/GUI.js"></script>
  <script src="/heroes/uniques/leech/GUI.js"></script>
  <script src="/heroes/uniques/pilot/GUI.js"></script>
  <script src="/heroes/uniques/germ/GUI.js"></script>
  <script src="/heroes/uniques/livingtree/GUI.js"></script>
  <script src="/heroes/uniques/ai/GUI.js"></script>
  <script>
    // Password check
    function checkPassword() {
      const input = document.getElementById('password-input').value;
      const correctPassword = [
        window.oddchunk1,
        window.oddchunk2,
        window.oddchunk3,
        window.oddchunk4,
        window.oddchunk5,
        window.oddchunk6,
        window.oddchunk7,
        window.oddchunk8,
        window.oddchunk9
      ].join('');
      const errorDiv = document.getElementById('password-error');
      if (input === correctPassword) {
        localStorage.setItem('oddHeroesAccess', 'granted');
        document.getElementById('password-modal').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
      } else {
        errorDiv.textContent = 'Invalid password. Try again.';
      }
    }

    // Check if password is cached
    if (localStorage.getItem('oddHeroesAccess') === 'granted') {
      document.getElementById('password-modal').classList.add('hidden');
      document.getElementById('main-content').classList.remove('hidden');
    }

    // Allow Enter key to submit password
    document.getElementById('password-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        checkPassword();
      }
    });

    // Hero-list
    const heroNames = [
      'AI', 'BigFoot', 'Centaur', 'Dinosaur', 'Dragon', 'Fairy', 'Ghost', 'Medusa', 'Merfolk', 'Phoenix',
      'Alchemist', 'Fisherman', 'Hunter', 'Miner', 'Ninja', 'Samurai', 'Spartan', 'Vampire', 'Warrior', 'Wizard',
      'Bear', 'Boar', 'Chicken', 'Dog', 'Duck', 'Falcon', 'Frog', 'HoneyBadger', 'Lizard', 'Mole', 'Raccoon', 'Rat', 'Shark', 'Tiger', 'Turtle',
      'Germ', 'Leech', 'LivingTree', 'Mosquito Swarm', 'Tick', 'Worm', 'Pilot'
    ];
    // pull from directory hero GUIs
    const heroData = [];
    const categoriesMap = {};
    heroNames.forEach(heroName => {
      const hero = window[`${heroName.replace(/\s+/g, '')}Data`];
      if (!hero) {
        console.error(`Error: Data for ${heroName} not found. Check if heroes/${hero?.category?.toLowerCase() || 'unknown'}/${heroName.toLowerCase().replace(/\s+/g, '-')}/GUI.js is loaded.`);
        return;
      }
      const catId = hero.id;
      if (!categoriesMap[catId]) {
        categoriesMap[catId] = {
          category: hero.category,
          id: catId,
          heroes: []
        };
        heroData.push(categoriesMap[catId]);
      }
      categoriesMap[catId].heroes.push({
        name: cannon,
        icon: hero.icon,
        abilities: hero.abilities,
        hp: hero.hp,
        speed: hero.speed,
        tileMove: hero.tileMove,
        passive: hero.passive
      });
    });
    // Log loaded heroes for debugging
    console.log('Loaded heroes:', heroData.map(cat => ({
      category: cat.category,
      heroes: cat.heroes.map(h => h.name)
    })));
    // Sort in order
    heroData.forEach(category => {
      category.heroes.sort((a, b) => a.name.localeCompare(b.name));
    });
    // Define custom category order
    const categoryOrder = ['Legends', 'Creatures', 'Humans', 'Uniques'];
    // Sort heroData to enforce custom category order
    heroData.sort((a, b) => categoryOrder.indexOf(a.category) - categoryOrder.indexOf(b.category));
    // Error handling if no heroes are loaded
    if (heroData.length === 0) {
      console.error('Error: No hero data loaded. Ensure hero GUI files are included.');
      const errorMessage = document.createElement('div');
      errorMessage.style.color = '#f00';
      errorMessage.textContent = 'Error loading hero data. Please check if hero GUI files are correctly included.';
      document.body.appendChild(errorMessage);
    } else {
      // Dynamically generate categories and hero tiles
      const categoriesContainer = document.getElementById('categories');
      const modalsContainer = document.getElementById('modals');
      const selectedHeroesDiv = document.getElementById('selected-heroes');
      const startButton = document.getElementById('start-button');
      let selectedHeroes = [];
      const sessionId = crypto.randomUUID();
      const categories = heroData.map(cat => ({
        title: null,
        list: null,
        selected: null,
        display: null,
        id: cat.id
      }));
      // Disable start button by default
      startButton.disabled = true;
      heroData.forEach((cat, index) => {
        // Create category container
        const categoryContainer = document.createElement('div');
        categoryContainer.className = 'category-container';
        // Create category title
        const categoryTitle = document.createElement('div');
        categoryTitle.className = 'category-title';
        categoryTitle.id = `${cat.id}-title`;
        categoryTitle.innerHTML = `<span class="selected-hero"></span>${cat.category}`;
        // Create grid container
        const gridContainer = document.createElement('div');
        gridContainer.className = 'grid-container';
        gridContainer.id = `${cat.id}-list`;
        // Populate hero tiles
        cat.heroes.forEach(hero => {
          const heroTile = document.createElement('div');
          heroTile.className = 'hero-tile';
          heroTile.innerHTML = `<div class="hero-icon">${hero.icon}</div>${hero.name}`;
          gridContainer.appendChild(heroTile);
        });
        categoryContainer.appendChild(categoryTitle);
        categoryContainer.appendChild(gridContainer);
        categoriesContainer.appendChild(categoryContainer);
        // Update categories array
        categories[index].title = categoryTitle;
        categories[index].list = gridContainer;
        categories[index].display = categoryTitle.querySelector('.selected-hero');
        // Create modal for each hero
        cat.heroes.forEach(hero => {
          const modal = document.createElement('div');
          modal.id = `${hero.name.toLowerCase().replace(/\s+/g, '-')}-modal`;
          modal.className = 'modal';
          const modalContent = document.createElement('div');
          modalContent.className = 'modal-content';
          modalContent.innerHTML = `
            <span class="modal-close" onclick="document.getElementById('${hero.name.toLowerCase().replace(/\s+/g, '-')}-modal').style.display='none'; document.getElementById('${cat.id}-list').querySelector('.selected')?.classList.remove('selected'); document.getElementById('${cat.id}-title').querySelector('.selected-hero').textContent=''; window.categories[${index}].selected=null; updateSelectedHeroes();">X</span>
            <div class="stats-display">
              <div class="label">HP: ${hero.hp || 'N/A'}</div>
              <div class="label">Speed: ${hero.speed || 'N/A'}</div>
              <div class="label">Tile Move: ${hero.tileMove || 'N/A'}</div>
            </div>
            <div class="passive-display">
              <div class="label">Passive: ${hero.passive?.label || 'No Passive'}</div>
              ${hero.passive?.description ? `<div class="description">${hero.passive.description}</div>` : ''}
            </div>
            <div class="instruction">Pick a CD ability</div>
            <div class="options"></div>
          `;
          const optionsContainer = modalContent.querySelector('.options');
          hero.abilities.forEach(ability => {
            const option = document.createElement('div');
            option.className = `option ${hero.abilities.length === 1 ? 'single-option' : ''}`;
            option.setAttribute('data-choice', ability.choice);
            option.innerHTML = `<span class="icon">${hero.icon}</span>${ability.label}${ability.description ? '<br>' + ability.description : ''}`;
            optionsContainer.appendChild(option);
          });
          modal.appendChild(modalContent);
          modalsContainer.appendChild(modal);
        });
      });
      // Toggle categories
      categories.forEach(cat => {
        cat.title.addEventListener('click', () => {
          const expanded = cat.list.classList.contains('expanded');
          categories.forEach(c => {
            c.list.classList.remove('expanded');
            c.title.classList.remove('expanded');
          });
          if (!expanded) {
            cat.list.classList.add('expanded');
            cat.title.classList.add('expanded');
          }
        });
      });
      // Update selected heroes display
      function updateSelectedHeroes() {
        selectedHeroes = categories.map(c => c.selected).filter(h => h && h.ability);
        selectedHeroesDiv.innerHTML = selectedHeroes.length
          ? selectedHeroes.map(h => `${h.name}: ${h.ability}`).join('<br>')
          : '';
        startButton.style.display = selectedHeroes.length && !selectedHeroes.some(h => !h.ability) ? 'inline-block' : 'none';
        startButton.disabled = selectedHeroes.length !== categories.length || selectedHeroes.some(h => !h.ability);
      }
      // Hero selection
      categories.forEach(cat => {
        cat.list.addEventListener('click', e => {
          const tile = e.target.closest('.hero-tile');
          if (!tile) return;
          const heroName = tile.querySelector('.hero-icon').nextSibling.textContent.trim();
          const heroIcon = tile.querySelector('.hero-icon').textContent;
          // If a hero is already selected in this category, deselect it
          if (cat.selected) {
            const selectedTile = cat.list.querySelector('.selected');
            if (selectedTile) selectedTile.classList.remove('selected');
            // Hide previous modal
            const prevHeroName = cat.selected.name;
            const prevModal = document.getElementById(`${prevHeroName.toLowerCase().replace(/\s+/g, '-')}-modal`);
            prevModal.style.display = 'none';
          }
          // Select new hero
          tile.classList.add('selected');
          cat.selected = { name: heroName, icon: heroIcon, ability: null };
          cat.display.textContent = `${heroName}`; // Show only hero name in category title
          // Find hero data
          const heroCat = heroData.find(c => c.id === cat.id);
          const hero = heroCat.heroes.find(h => h.name === heroName);
          // Show modal
          const modal = document.getElementById(`${heroName.toLowerCase().replace(/\s+/g, '-')}-modal`);
          modal.style.display = 'flex';
          const options = modal.querySelectorAll('.option');
          options.forEach(opt => {
            opt.addEventListener('click', function handleChoice() {
              const choice = this.getAttribute('data-choice');
              cat.selected.ability = choice;
              const ability = hero.abilities.find(a => a.choice === choice);
              cat.display.textContent = `${heroName}: ${ability.label}`; // Updated format for category title
              modal.style.display = 'none';
              cat.list.classList.remove('expanded');
              cat.title.classList.remove('expanded');
              options.forEach(o => o.removeEventListener('click', handleChoice));
              updateSelectedHeroes();
            }, { once: true });
          });
        });
      });
      // Start button - redirect with selected heroes and sessionId
      startButton.addEventListener('click', () => {
        if (selectedHeroes.length !== categories.length || selectedHeroes.some(h => !h.ability)) return;
        const heroesQuery = encodeURIComponent(JSON.stringify(selectedHeroes.map(h => ({ name: h.name, ability: h.ability }))));
        window.location.href = `matchmaking.html?heroes=${heroesQuery}&sessionId=${encodeURIComponent(sessionId)}`;
      });
    }
  </script>
</body>
</html>
